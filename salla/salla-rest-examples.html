<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salla REST API Examples - Mukhawara</title>
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/index.css">
</head>
<body>
    <div class="container mt-5">
        <h1>Salla REST API Examples</h1>
        <p class="lead">Connected to: <strong>mukhaura.salla.sa</strong></p>
        <p>This page demonstrates Salla REST API integration for external websites.</p>
        
        <!-- Authentication Section -->
        <div class="row mt-4">
            <div class="col-md-6">
                <h3>Authentication</h3>
                <button class="btn btn-success me-2" onclick="authenticate()">Authenticate with Salla</button>
                <button class="btn btn-danger me-2" onclick="logout()">Logout</button>
                <button class="btn btn-info" onclick="checkAuthStatus()">Check Auth Status</button>
                
                <div class="mt-3">
                    <h4>Auth Status:</h4>
                    <div id="auth-status">Checking...</div>
                </div>
            </div>
            
            <div class="col-md-6">
                <h3>Store Information</h3>
                <button class="btn btn-primary me-2" onclick="getStoreInfo()">Get Store Info</button>
                <button class="btn btn-info" onclick="getCategories()">Get Categories</button>
                
                <div class="mt-3">
                    <h4>Store Info:</h4>
                    <div id="store-info">Loading...</div>
                </div>
            </div>
        </div>
        
        <!-- Product Operations -->
        <div class="row mt-4">
            <div class="col-md-6">
                <h3>Product Operations</h3>
                <button class="btn btn-primary me-2" onclick="getProducts()">Get Products</button>
                <button class="btn btn-success me-2" onclick="searchProducts()">Search Products</button>
                <input type="text" id="search-query" class="form-control d-inline-block w-auto" placeholder="Search..." value="fabric">
                <button class="btn btn-info" onclick="getProductDetails()">Get Product Details</button>
                <input type="number" id="product-id" class="form-control d-inline-block w-auto ms-2" placeholder="Product ID" value="12345">
                
                <div class="mt-3">
                    <h4>Product Info:</h4>
                    <div id="product-info">Loading...</div>
                </div>
            </div>
            
            <div class="col-md-6">
                <h3>Cart Operations</h3>
                <button class="btn btn-primary me-2" onclick="addToCart()">Add to Cart</button>
                <input type="number" id="cart-product-id" class="form-control d-inline-block w-auto" placeholder="Product ID" value="12345">
                <button class="btn btn-info me-2" onclick="getCart()">Get Cart</button>
                <button class="btn btn-warning" onclick="clearCart()">Clear Cart</button>
                
                <div class="mt-3">
                    <h4>Cart Status:</h4>
                    <div id="cart-status">Loading...</div>
                </div>
            </div>
        </div>
        
        <!-- Event Logs -->
        <div class="row mt-4">
            <div class="col-12">
                <h3>API Logs</h3>
                <div id="event-log" class="border p-3" style="height: 200px; overflow-y: auto; background: #f8f9fa;">
                    <p>API logs will appear here...</p>
                </div>
            </div>
        </div>
        
        <!-- Setup Instructions -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="alert alert-info">
                    <h4>Setup Required:</h4>
                    <ol>
                        <li>Create a Salla Developer Account at <a href="https://salla.partners" target="_blank">salla.partners</a></li>
                        <li>Create an OAuth App to get Client ID and Client Secret</li>
                        <li>Update the Client ID and Secret in <code>js/salla-rest-api.js</code></li>
                        <li>Click "Authenticate with Salla" to connect your store</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- Salla REST API -->
    <script src="../js/salla-rest-api.js"></script>
    <script>
        // Sample product ID for demonstration
        const SAMPLE_PRODUCT_ID = 12345;
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            logEvent('Salla REST API examples loaded');
            checkAuthStatus();
        });
        
        function authenticate() {
            logEvent('Starting OAuth authentication...');
            SallaIntegration.authenticate();
        }
        
        function logout() {
            localStorage.removeItem('salla_access_token');
            logEvent('Logged out - access token removed');
            checkAuthStatus();
        }
        
        function checkAuthStatus() {
            const token = localStorage.getItem('salla_access_token');
            const statusDiv = document.getElementById('auth-status');
            
            if (token) {
                statusDiv.innerHTML = '<p class="text-success">✓ Authenticated</p>';
                logEvent('User is authenticated');
            } else {
                statusDiv.innerHTML = '<p class="text-warning">⚠ Not authenticated</p>';
                logEvent('User is not authenticated');
            }
        }
        
        async function getStoreInfo() {
            const infoDiv = document.getElementById('store-info');
            infoDiv.innerHTML = 'Loading...';
            
            try {
                const storeInfo = await SallaIntegration.getStoreInfo();
                infoDiv.innerHTML = `
                    <p><strong>Store Name:</strong> ${storeInfo.data.name}</p>
                    <p><strong>Domain:</strong> ${storeInfo.data.domain}</p>
                    <p><strong>Email:</strong> ${storeInfo.data.email}</p>
                    <p><strong>Status:</strong> ${storeInfo.data.status}</p>
                `;
                logEvent('Store info retrieved successfully');
            } catch (error) {
                infoDiv.innerHTML = `<p class="text-danger">Error: ${error.message}</p>`;
                logEvent(`Store info error: ${error.message}`);
            }
        }
        
        async function getCategories() {
            try {
                const categories = await SallaIntegration.getCategories();
                logEvent(`Retrieved ${categories.data.length} categories`);
            } catch (error) {
                logEvent(`Categories error: ${error.message}`);
            }
        }
        
        async function getProducts() {
            const infoDiv = document.getElementById('product-info');
            infoDiv.innerHTML = 'Loading...';
            
            try {
                const products = await SallaIntegration.getProducts();
                infoDiv.innerHTML = `
                    <p><strong>Total Products:</strong> ${products.data.length}</p>
                    <div class="mt-2">
                        <strong>First 3 Products:</strong>
                        ${products.data.slice(0, 3).map(p => `<p>• ${p.name} (${p.price} SAR)</p>`).join('')}
                    </div>
                `;
                logEvent(`Retrieved ${products.data.length} products`);
            } catch (error) {
                infoDiv.innerHTML = `<p class="text-danger">Error: ${error.message}</p>`;
                logEvent(`Products error: ${error.message}`);
            }
        }
        
        async function searchProducts() {
            const query = document.getElementById('search-query').value;
            const infoDiv = document.getElementById('product-info');
            infoDiv.innerHTML = 'Searching...';
            
            try {
                const results = await SallaIntegration.searchProducts(query);
                infoDiv.innerHTML = `
                    <p><strong>Search Results:</strong> ${results.data.length} products found for "${query}"</p>
                    <div class="mt-2">
                        ${results.data.slice(0, 3).map(p => `<p>• ${p.name} (${p.price} SAR)</p>`).join('')}
                    </div>
                `;
                logEvent(`Search for "${query}" found ${results.data.length} results`);
            } catch (error) {
                infoDiv.innerHTML = `<p class="text-danger">Error: ${error.message}</p>`;
                logEvent(`Search error: ${error.message}`);
            }
        }
        
        async function getProductDetails() {
            const productId = document.getElementById('product-id').value;
            const infoDiv = document.getElementById('product-info');
            infoDiv.innerHTML = 'Loading...';
            
            try {
                const product = await SallaIntegration.searchProducts(productId);
                infoDiv.innerHTML = `
                    <p><strong>Product:</strong> ${product.data[0]?.name || 'Not found'}</p>
                    <p><strong>Price:</strong> ${product.data[0]?.price || 'N/A'} SAR</p>
                    <p><strong>Status:</strong> ${product.data[0]?.status || 'N/A'}</p>
                `;
                logEvent(`Product details retrieved for ID: ${productId}`);
            } catch (error) {
                infoDiv.innerHTML = `<p class="text-danger">Error: ${error.message}</p>`;
                logEvent(`Product details error: ${error.message}`);
            }
        }
        
        async function addToCart() {
            const productId = document.getElementById('cart-product-id').value;
            const statusDiv = document.getElementById('cart-status');
            statusDiv.innerHTML = 'Adding to cart...';
            
            try {
                const result = await SallaIntegration.addToCart(parseInt(productId), 1);
                statusDiv.innerHTML = '<p class="text-success">✓ Product added to cart</p>';
                logEvent(`Product ${productId} added to cart`);
            } catch (error) {
                statusDiv.innerHTML = `<p class="text-danger">Error: ${error.message}</p>`;
                logEvent(`Add to cart error: ${error.message}`);
            }
        }
        
        async function getCart() {
            const statusDiv = document.getElementById('cart-status');
            statusDiv.innerHTML = 'Loading...';
            
            try {
                const cart = await SallaIntegration.getCart();
                statusDiv.innerHTML = `
                    <p><strong>Items:</strong> ${cart.data.items?.length || 0}</p>
                    <p><strong>Total:</strong> ${cart.data.total || 0} SAR</p>
                `;
                logEvent('Cart retrieved successfully');
            } catch (error) {
                statusDiv.innerHTML = `<p class="text-danger">Error: ${error.message}</p>`;
                logEvent(`Cart error: ${error.message}`);
            }
        }
        
        function clearCart() {
            document.getElementById('cart-status').innerHTML = '<p class="text-warning">Clear cart not implemented in demo</p>';
            logEvent('Clear cart - not implemented in demo');
        }
        
        function logEvent(message) {
            const eventLog = document.getElementById('event-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('p');
            logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            eventLog.appendChild(logEntry);
            eventLog.scrollTop = eventLog.scrollHeight;
        }
    </script>
</body>
</html>
